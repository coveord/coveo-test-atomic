{"version":3,"names":["getAnalyticsConfig","commerceEngineConfig","enabled","defaultConfiguration","documentLocation","document","location","href","referrer","originLevel3","analyticsMode","analytics","createAtomicCommerceStore","type","commonStore","createAtomicCommonStore","loadingFlags","facets","numericFacets","dateFacets","categoryFacets","facetElements","sortOptions","iconAssetsPath","mobileBreakpoint","DEFAULT_MOBILE_BREAKPOINT","fieldsToInclude","currentQuickviewPosition","activeProductChild","undefined","getAllFacets","state","isMobile","window","matchMedia","makeDesktopQuery","matches","getUniqueIDFromEngine","engine","Selectors","Search","responseIdSelector","ProductListing","Error","atomicCommerceInterfaceCss","AtomicCommerceInterfaceStyle0","FirstRequestExecutedFlag","AtomicCommerceInterface","constructor","hostRef","this","unsubscribeUrlManager","unsubscribeSummary","initialized","i18n","i18next","createInstance","reflectStateInUrl","scrollContainer","languageAssetsPath","onHashChange","urlManager","synchronize","fragment","commonInterfaceHelper","CommonAtomicInterfaceHelper","store","connectedCallback","setLoadingFlag","i18nClone","cloneInstance","addResourceBundle","lng","ns","resources","deep","overwrite","componentWillLoad","CspNonce","setNonce","initAriaLive","toggleAnalytics","onAnalyticsChange","updateLanguage","engineIsCreated","language","context","setLanguage","onLanguageChange","updateIconAssetsPath","set","disconnectedCallback","removeEventListener","handleInitialization","event","onComponentInitializing","scrollToTop","scrollContainerElement","querySelector","bindings","logger","warn","scrollIntoView","behavior","initialize","options","internalInitialization","initEngine","initializeWithEngine","executeFirstRequest","console","error","host","safeStorage","SafeStorage","standaloneSearchBoxData","getParsedJSON","StorageItems","STANDALONE_SEARCH_BOX_DATA","searchOrListing","executeFirstSearch","removeItem","value","dispatch","loadQueryActions","updateQuery","query","interfaceElement","createStyleElement","styleTag","createElement","setAttribute","createScriptElement","analyticsConfig","buildCommerceEngine","configuration","loggerOptions","level","logLevel","hash","slice","Array","from","children","some","element","tagName","prepend","initUrlManager","initialState","subscribe","updateHash","addEventListener","initRequestStatus","buildProductListing","buildSearch","initSummary","summary","firstRequestExecuted","hasProducts","hasError","hasNoProductsAfterInitialQuery","classList","toggle","noProductsSelector","errorSelector","firstSearchExecutedSelector","unsetLoadingFlag","initContext","buildContext","initLanguage","newFragment","isLoading","history","replaceState","title","info","pushState","onInitialization","render","h","key"],"sources":["src/components/commerce/atomic-commerce-interface/analytics-config.ts","src/components/commerce/atomic-commerce-interface/store.ts","src/components/commerce/atomic-commerce-interface/atomic-commerce-interface.pcss?tag=atomic-commerce-interface&encapsulation=shadow","src/components/commerce/atomic-commerce-interface/atomic-commerce-interface.tsx"],"sourcesContent":["import {\n  AnalyticsConfiguration,\n  CommerceEngineConfiguration,\n} from '@coveo/headless/commerce';\n\nexport function getAnalyticsConfig(\n  commerceEngineConfig: CommerceEngineConfiguration,\n  enabled: boolean\n): AnalyticsConfiguration {\n  const defaultConfiguration: AnalyticsConfiguration = {\n    enabled,\n    documentLocation: document.location.href,\n    ...(document.referrer && {originLevel3: document.referrer}),\n    analyticsMode: 'next',\n  };\n\n  if (commerceEngineConfig.analytics) {\n    return {\n      ...defaultConfiguration,\n      ...commerceEngineConfig.analytics,\n    };\n  }\n  return defaultConfiguration;\n}\n","import {\n  CommerceEngine,\n  Selectors,\n  NumericFacetValue,\n  DateFacetValue,\n  SortCriterion,\n  ChildProduct,\n} from '@coveo/headless/commerce';\nimport {DEFAULT_MOBILE_BREAKPOINT} from '../../../utils/replace-breakpoint';\nimport {\n  FacetInfo,\n  FacetStore,\n  FacetValueFormat,\n} from '../../common/facets/facet-common-store';\nimport {\n  createAtomicCommonStore,\n  AtomicCommonStoreData,\n  AtomicCommonStore,\n} from '../../common/interface/store';\nimport {makeDesktopQuery} from '../../search/atomic-layout/search-layout';\n\nexport interface SortDropdownOption {\n  expression: string;\n  criteria: SortCriterion[];\n  label: string;\n}\n\nexport interface AtomicStoreData extends AtomicCommonStoreData {\n  facets: FacetStore<FacetInfo>;\n  numericFacets: FacetStore<FacetInfo & FacetValueFormat<NumericFacetValue>>;\n  dateFacets: FacetStore<FacetInfo & FacetValueFormat<DateFacetValue>>;\n  categoryFacets: FacetStore<FacetInfo>;\n  sortOptions: SortDropdownOption[];\n  mobileBreakpoint: string;\n  currentQuickviewPosition: number;\n  activeProductChild: ChildProduct | undefined;\n}\n\nexport interface AtomicCommerceStore\n  extends AtomicCommonStore<AtomicStoreData> {\n  getAllFacets(): FacetInfoMap;\n  isMobile(): boolean;\n}\n\nexport interface FacetInfoMap {\n  [facetId: string]:\n    | FacetInfo\n    | (FacetInfo & FacetValueFormat<NumericFacetValue>)\n    | (FacetInfo & FacetValueFormat<DateFacetValue>);\n}\n\nexport function createAtomicCommerceStore(\n  type: 'search' | 'product-listing'\n): AtomicCommerceStore {\n  const commonStore = createAtomicCommonStore<AtomicStoreData>({\n    loadingFlags: [],\n    facets: {},\n    numericFacets: {},\n    dateFacets: {},\n    categoryFacets: {},\n    facetElements: [],\n    sortOptions: [],\n    iconAssetsPath: '',\n    mobileBreakpoint: DEFAULT_MOBILE_BREAKPOINT,\n    fieldsToInclude: [],\n    currentQuickviewPosition: -1,\n    activeProductChild: undefined,\n  });\n\n  return {\n    ...commonStore,\n\n    getAllFacets() {\n      return {\n        ...commonStore.state.facets,\n        ...commonStore.state.dateFacets,\n        ...commonStore.state.categoryFacets,\n        ...commonStore.state.numericFacets,\n      };\n    },\n\n    isMobile() {\n      return !window.matchMedia(\n        makeDesktopQuery(commonStore.state.mobileBreakpoint)\n      ).matches;\n    },\n\n    getUniqueIDFromEngine(engine: CommerceEngine): string {\n      switch (type) {\n        case 'search':\n          return Selectors.Search.responseIdSelector(engine);\n        case 'product-listing':\n          return Selectors.ProductListing.responseIdSelector(engine);\n        default:\n          throw new Error(\n            `getUniqueIDFromEngine not implemented for this interface type, ${type}`\n          );\n      }\n    },\n  };\n}\n","@import '../../../global/global.pcss';\n\n:host {\n  height: inherit;\n  width: inherit;\n  & > slot {\n    height: inherit;\n  }\n}\n","import {\n  LogLevel,\n  Search,\n  Unsubscribe,\n  UrlManager,\n  buildSearch,\n  loadQueryActions,\n  CommerceEngine,\n  CommerceEngineConfiguration,\n  buildCommerceEngine,\n  buildProductListing,\n  ProductListing,\n  Context,\n  buildContext,\n  Summary,\n  SearchSummaryState,\n  ProductListingSummaryState,\n} from '@coveo/headless/commerce';\nimport {\n  Component,\n  Prop,\n  h,\n  Listen,\n  Method,\n  Watch,\n  Element,\n  State,\n  setNonce,\n} from '@stencil/core';\nimport i18next, {i18n} from 'i18next';\nimport {InitializeEvent} from '../../../utils/initialization-utils';\nimport {\n  SafeStorage,\n  StandaloneSearchBoxData,\n  StorageItems,\n} from '../../../utils/local-storage-utils';\nimport {CommonBindings, NonceBindings} from '../../common/interface/bindings';\nimport {\n  BaseAtomicInterface,\n  CommonAtomicInterfaceHelper,\n} from '../../common/interface/interface-common';\nimport {\n  errorSelector,\n  firstSearchExecutedSelector,\n  noProductsSelector,\n} from '../atomic-commerce-layout/commerce-layout';\nimport {getAnalyticsConfig} from './analytics-config';\nimport {AtomicCommerceStore, createAtomicCommerceStore} from './store';\n\nconst FirstRequestExecutedFlag = 'firstRequestExecuted';\n\nexport type CommerceInitializationOptions = CommerceEngineConfiguration;\nexport type CommerceBindings = CommonBindings<\n  CommerceEngine,\n  AtomicCommerceStore,\n  HTMLAtomicCommerceInterfaceElement\n> &\n  NonceBindings;\n\n/**\n * @internal\n * The `atomic-commerce-interface` component is the parent to all other atomic commerce components in a commerce page\n * (except for `atomic-commerce-recommendation-list`, which must have\n * `atomic-commerce-recommendation-interface` as a parent). It handles the headless commerce engine and localization\n * configurations.\n */\n@Component({\n  tag: 'atomic-commerce-interface',\n  styleUrl: 'atomic-commerce-interface.pcss',\n  shadow: true,\n  assetsDirs: ['lang'],\n})\nexport class AtomicCommerceInterface\n  implements BaseAtomicInterface<CommerceEngine>\n{\n  private urlManager!: UrlManager;\n  private searchOrListing!: Search | ProductListing;\n  private summary!: Summary<SearchSummaryState | ProductListingSummaryState>;\n  private context!: Context;\n  private unsubscribeUrlManager: Unsubscribe = () => {};\n  private unsubscribeSummary: Unsubscribe = () => {};\n  private initialized = false;\n  private store: AtomicCommerceStore;\n  private commonInterfaceHelper: CommonAtomicInterfaceHelper<CommerceEngine>;\n\n  @Element() public host!: HTMLAtomicCommerceInterfaceElement;\n\n  @State() public error?: Error;\n\n  /**\n   * The type of the interface.\n   * - 'search': Indicates that the interface is used for Search.\n   * - 'product-listing': Indicates that the interface is used for Product listing.\n   */\n  @Prop({reflect: true, mutable: true}) public type:\n    | 'search'\n    | 'product-listing' = 'search';\n\n  /**\n   * Whether analytics should be enabled.\n   */\n  @Prop({reflect: true}) public analytics = true;\n\n  /**\n   * The severity level of the messages to log in the console.\n   */\n  @Prop({reflect: true}) public logLevel?: LogLevel;\n\n  /**\n   * the commerce interface i18next instance.\n   */\n  @Prop() public i18n: i18n = i18next.createInstance();\n\n  /**\n   * the commerce interface language.\n   *\n   * Will default to the value set in the Headless engine context if not provided.\n   */\n  @Prop({reflect: true, mutable: true}) public language?: string;\n\n  /**\n   * The commerce interface headless engine.\n   */\n  @Prop({mutable: true}) public engine?: CommerceEngine;\n\n  /**\n   * Whether the state should be reflected in the URL parameters.\n   */\n  @Prop({reflect: true}) public reflectStateInUrl = true;\n\n  /**\n   * The CSS selector for the container where the interface will scroll back to.\n   */\n  @Prop({reflect: true}) public scrollContainer = 'atomic-commerce-interface';\n\n  /**\n   * The language assets path. By default, this will be a relative URL pointing to `./lang`.\n   *\n   * Example: \"/mypublicpath/languages\"\n   *\n   */\n  @Prop({reflect: true}) public languageAssetsPath = './lang';\n\n  /**\n   * The icon assets path. By default, this will be a relative URL pointing to `./assets`.\n   *\n   * Example: \"/mypublicpath/icons\"\n   *\n   */\n  @Prop({reflect: true}) public iconAssetsPath = './assets';\n\n  /**\n   * The value to set the [nonce](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/nonce) attribute to on inline script and style elements generated by this interface and its child components.\n   * If your application is served with a Content Security Policy (CSP) that doesn't include the `script-src: 'unsafe-inline'` or `style-src: 'unsafe-inline'` directives,\n   * you should ensure that your application server generates a new nonce on every page load and uses the generated value to set this prop and serve the corresponding CSP response headers\n   * (i.e., script-src 'nonce-<YOUR_GENERATED_NONCE>' and style-src 'nonce-<YOUR_GENERATED_NONCE>').\n   * Otherwise you may see console errors such as\n   *  - Refused to execute inline script because it violates the following Content Security Policy directive: [...]\n   *  - Refused to apply inline style because it violates the following Content Security Policy directive: [...].\n   * @example:\n   * ```html\n   * <script nonce=\"<YOUR_GENERATED_NONCE>\">\n   *  import {setNonce} from '@coveo/atomic';\n   *  setNonce('<YOUR_GENERATED_NONCE>');\n   * </script>\n   * ```\n   */\n  @Prop({reflect: true}) public CspNonce?: string;\n\n  /**\n   * A reference clone of the interface i18next instance.\n   */\n  private i18nClone!: i18n;\n\n  public constructor() {\n    this.commonInterfaceHelper = new CommonAtomicInterfaceHelper(\n      this,\n      'CoveoAtomic'\n    );\n    this.store = createAtomicCommerceStore(this.type);\n  }\n\n  public connectedCallback() {\n    this.store.setLoadingFlag(FirstRequestExecutedFlag);\n    this.i18nClone = this.i18n.cloneInstance();\n    this.i18n.addResourceBundle = (\n      lng: string,\n      ns: string,\n      resources: object,\n      deep?: boolean,\n      overwrite?: boolean\n    ) => this.addResourceBundle(lng, ns, resources, deep, overwrite);\n  }\n\n  componentWillLoad() {\n    if (this.CspNonce) {\n      setNonce(this.CspNonce);\n    }\n    this.initAriaLive();\n  }\n\n  @Watch('analytics')\n  public toggleAnalytics() {\n    this.commonInterfaceHelper.onAnalyticsChange();\n  }\n\n  @Watch('language')\n  public updateLanguage() {\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\n      return;\n    }\n    if (!this.language) {\n      return;\n    }\n\n    this.context.setLanguage(this.language);\n    this.commonInterfaceHelper.onLanguageChange();\n  }\n\n  @Watch('iconAssetsPath')\n  public updateIconAssetsPath() {\n    this.store.set('iconAssetsPath', this.iconAssetsPath);\n  }\n\n  public disconnectedCallback() {\n    this.unsubscribeUrlManager();\n    this.unsubscribeSummary();\n    window.removeEventListener('hashchange', this.onHashChange);\n  }\n\n  @Listen('atomic/initializeComponent')\n  public handleInitialization(event: InitializeEvent) {\n    this.commonInterfaceHelper.onComponentInitializing(event);\n  }\n\n  @Listen('atomic/scrollToTop')\n  public scrollToTop() {\n    const scrollContainerElement = document.querySelector(this.scrollContainer);\n    if (!scrollContainerElement) {\n      this.bindings.engine.logger.warn(\n        `Could not find the scroll container with the selector \"${this.scrollContainer}\". This will prevent UX interactions that require a scroll from working correctly. Please check the CSS selector in the scrollContainer option`\n      );\n      return;\n    }\n\n    scrollContainerElement.scrollIntoView({behavior: 'smooth'});\n  }\n\n  /**\n   * Initializes the connection with the headless commerce engine using options for accessToken (required), organizationId (required), renewAccessToken, organizationEndpoints (recommended), and platformUrl (deprecated).\n   */\n  @Method() public initialize(options: CommerceInitializationOptions) {\n    return this.internalInitialization(() => this.initEngine(options));\n  }\n\n  /**\n   * Initializes the connection with an already preconfigured [headless commerce engine](https://docs.coveo.com/en/headless/latest/reference/commerce/), as opposed to the `initialize` method, which will internally create a new commerce engine instance.\n   * This bypasses the properties set on the component, such as analytics and language.\n   */\n  @Method() public initializeWithEngine(engine: CommerceEngine) {\n    return this.internalInitialization(() => (this.engine = engine));\n  }\n\n  /**\n   *\n   * Executes the first request after initializing connection to the headless commerce engine.\n   */\n  @Method() public async executeFirstRequest() {\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\n      return;\n    }\n\n    if (!this.initialized) {\n      console.error(\n        'You have to wait until the \"initialize\" promise is fulfilled before executing a request.',\n        this.host\n      );\n      return;\n    }\n\n    if (this.type === 'search') {\n      const safeStorage = new SafeStorage();\n\n      const standaloneSearchBoxData =\n        safeStorage.getParsedJSON<StandaloneSearchBoxData | null>(\n          StorageItems.STANDALONE_SEARCH_BOX_DATA,\n          null\n        );\n\n      if (!standaloneSearchBoxData) {\n        (this.searchOrListing as Search).executeFirstSearch();\n        return;\n      }\n\n      safeStorage.removeItem(StorageItems.STANDALONE_SEARCH_BOX_DATA);\n      const {value} = standaloneSearchBoxData;\n\n      this.engine.dispatch(\n        loadQueryActions(this.engine).updateQuery({query: value})\n      );\n      (this.searchOrListing as Search).executeFirstSearch();\n    } else {\n      (this.searchOrListing as ProductListing).executeFirstRequest();\n    }\n  }\n\n  public get bindings(): CommerceBindings {\n    return {\n      engine: this.engine!,\n      i18n: this.i18n,\n      store: this.store,\n      interfaceElement: this.host,\n      createStyleElement: () => {\n        const styleTag = document.createElement('style');\n        if (this.CspNonce) {\n          styleTag.setAttribute('nonce', this.CspNonce);\n        }\n        return styleTag;\n      },\n      createScriptElement: () => {\n        const styleTag = document.createElement('script');\n        if (this.CspNonce) {\n          styleTag.setAttribute('nonce', this.CspNonce);\n        }\n        return styleTag;\n      },\n    };\n  }\n\n  private initEngine(options: CommerceInitializationOptions) {\n    const analyticsConfig = getAnalyticsConfig(options, this.analytics);\n    try {\n      this.engine = buildCommerceEngine({\n        configuration: {\n          ...options,\n          analytics: analyticsConfig,\n        },\n        loggerOptions: {\n          level: this.logLevel,\n        },\n      });\n    } catch (error) {\n      this.error = error as Error;\n      throw error;\n    }\n  }\n\n  private get fragment() {\n    return window.location.hash.slice(1);\n  }\n\n  private initAriaLive() {\n    if (\n      Array.from(this.host.children).some(\n        (element) => element.tagName === 'ATOMIC-ARIA-LIVE'\n      )\n    ) {\n      return;\n    }\n    this.host.prepend(document.createElement('atomic-aria-live'));\n  }\n\n  private initUrlManager() {\n    this.urlManager = this.searchOrListing.urlManager({\n      initialState: {fragment: this.fragment},\n    });\n\n    this.unsubscribeUrlManager = this.urlManager.subscribe(() =>\n      this.updateHash()\n    );\n\n    window.addEventListener('hashchange', this.onHashChange);\n  }\n\n  private initRequestStatus() {\n    this.searchOrListing =\n      this.type === 'product-listing'\n        ? buildProductListing(this.engine!)\n        : buildSearch(this.engine!);\n  }\n\n  private initSummary() {\n    this.summary = this.searchOrListing.summary();\n\n    this.unsubscribeSummary = this.summary.subscribe(() => {\n      const {firstRequestExecuted, hasProducts, hasError} = this.summary.state;\n      const hasNoProductsAfterInitialQuery =\n        firstRequestExecuted && !hasError && !hasProducts;\n\n      this.host.classList.toggle(\n        noProductsSelector,\n        hasNoProductsAfterInitialQuery\n      );\n\n      this.host.classList.toggle(errorSelector, hasError);\n\n      this.host.classList.toggle(\n        firstSearchExecutedSelector,\n        firstRequestExecuted\n      );\n\n      if (firstRequestExecuted) {\n        this.store.unsetLoadingFlag(FirstRequestExecutedFlag);\n      }\n    });\n  }\n\n  private initContext() {\n    this.context = buildContext(this.engine!);\n  }\n\n  private initLanguage() {\n    if (!this.language) {\n      this.language = this.context.state.language;\n    }\n  }\n\n  private updateHash() {\n    const newFragment = this.urlManager.state.fragment;\n\n    if (!this.searchOrListing.state.isLoading) {\n      history.replaceState(null, document.title, `#${newFragment}`);\n      this.bindings.engine.logger.info(`History replaceState #${newFragment}`);\n\n      return;\n    }\n\n    history.pushState(null, document.title, `#${newFragment}`);\n    this.bindings.engine.logger.info(`History pushState #${newFragment}`);\n  }\n\n  private onHashChange = () => {\n    this.urlManager.synchronize(this.fragment);\n  };\n\n  private async internalInitialization(initEngine: () => void) {\n    await this.commonInterfaceHelper.onInitialization(initEngine);\n\n    this.initRequestStatus();\n    this.initSummary();\n    this.initContext();\n    this.initLanguage();\n    this.initUrlManager();\n    this.initialized = true;\n  }\n\n  private addResourceBundle(\n    lng: string,\n    ns: string,\n    resources: object,\n    deep?: boolean,\n    overwrite?: boolean\n  ) {\n    return this.i18nClone.addResourceBundle(\n      lng,\n      ns,\n      resources,\n      deep,\n      overwrite\n    );\n  }\n\n  public render() {\n    return [<slot></slot>];\n  }\n}\n"],"mappings":"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"}