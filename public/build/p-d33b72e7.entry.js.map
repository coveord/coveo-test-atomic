{"version":3,"names":["atomicBreadboxCss","AtomicBreadboxStyle0","AtomicBreadbox","this","lastRemovedBreadcrumbIndex","numberOfBreadcrumbs","numberOfCollapsedBreadcrumbs","isCollapsed","pathLimit","initialize","validateProps","breadcrumbManager","buildBreadcrumbManager","bindings","engine","facetManager","buildFacetManager","window","ResizeObserver","resizeObserver","adaptBreadcrumbs","observe","host","parentElement","Schema","NumberValue","default","min","required","validate","disconnectedCallback","_a","disconnect","focusTargets","breadcrumbRemovedFocus","FocusTargetController","breadcrumbShowLessFocus","breadcrumbShowMoreFocus","breadcrumbs","Array","from","shadowRoot","querySelectorAll","hide","element","style","display","show","showAllBreadcrumbs","forEach","breadcrumb","hideOverflowingBreadcrumbs","hiddenBreadcrumbs","i","length","isOverflowing","updateShowMoreValue","updateShowLessDisplay","showLess","offsetTop","listElement","querySelector","scrollWidth","clientWidth","value","showMore","textContent","toLocaleString","i18n","language","setAttribute","t","facetBreadcrumbs","breadcrumbManagerState","map","facetId","field","values","flat","filter","store","state","facets","label","deselect","formattedValue","getFieldValueCaption","categoryFacetBreadcrumbs","path","categoryFacets","pathValue","numericFacetBreadcrumbs","numericFacets","format","content","_b","call","dateFacetBreadcrumbs","dateFacets","automaticFacetBreadcrumbs","flatMap","allBreadcrumbs","renderBreadcrumbs","sortedBreadcrumbs","sort","a","b","indexA","facetManagerState","facetIds","indexOf","indexB","index","isLastBreadcrumb","h","BreadcrumbButton","setRef","ref","setTarget","firstExpandedBreadcrumbIndex","onSelectBreadcrumb","resultList","focusOnFirstResultAfterNextSearch","focusAfterSearch","BreadcrumbContent","render","Hidden","BreadcrumbContainer","BreadcrumbShowMore","el","onShowMore","focusOnNextTarget","BreadcrumbShowLess","onShowLess","BreadcrumbClearAll","onClick","async","deselectAll","componentDidRender","__decorate","InitializeBindings","BindStateToController"],"sources":["src/components/search/atomic-breadbox/atomic-breadbox.pcss?tag=atomic-breadbox&encapsulation=shadow","src/components/search/atomic-breadbox/atomic-breadbox.tsx"],"sourcesContent":["@import '../../../global/global.pcss';\n@import '../../common/atomic-rating/atomic-rating.pcss';\n\n.max-w-snippet {\n  max-width: 30ch;\n}\n\n[part='breadcrumb-label'].excluded,\n[part='breadcrumb-value'].excluded {\n  text-decoration: line-through;\n  color: var(--atomic-error);\n}\n\n/* When excluded, strikethrough line must be continuous, so we must prepend empty character instead of margin */\n[part='breadcrumb-value']::before {\n  content: '\\00a0';\n}\n","import {NumberValue, Schema} from '@coveo/bueno';\nimport {\n  BreadcrumbManagerState,\n  BreadcrumbManager,\n  buildBreadcrumbManager,\n  FacetManager,\n  FacetManagerState,\n  buildFacetManager,\n} from '@coveo/headless';\nimport {Component, h, State, Element, Prop} from '@stencil/core';\nimport {FocusTargetController} from '../../../utils/accessibility-utils';\nimport {getFieldValueCaption} from '../../../utils/field-utils';\nimport {\n  InitializableComponent,\n  BindStateToController,\n  InitializeBindings,\n} from '../../../utils/initialization-utils';\nimport {BreadcrumbButton} from '../../common/breadbox/breadcrumb-button';\nimport {BreadcrumbClearAll} from '../../common/breadbox/breadcrumb-clear-all';\nimport {BreadcrumbContainer} from '../../common/breadbox/breadcrumb-container';\nimport {BreadcrumbContent} from '../../common/breadbox/breadcrumb-content';\nimport {BreadcrumbShowLess} from '../../common/breadbox/breadcrumb-show-less';\nimport {BreadcrumbShowMore} from '../../common/breadbox/breadcrumb-show-more';\nimport {Breadcrumb as BreadboxBreadcrumb} from '../../common/breadbox/breadcrumb-types';\nimport {Hidden} from '../../common/hidden';\nimport {Bindings} from '../atomic-search-interface/atomic-search-interface';\n\n/**\n * The `atomic-breadbox` component creates breadcrumbs that display a summary of the currently active facet values.\n *\n * @part container - The container of the whole component, list & label.\n * @part breadcrumb-list-container - The container of the list of breadcrumb buttons.\n * @part breadcrumb-list - The list of breadcrumb buttons.\n * @part breadcrumb-button - A single breadcrumb button.\n * @part breadcrumb-label - The breadcrumb label, associated with the facet.\n * @part breadcrumb-value - The breadcrumb formatted value.\n * @part breadcrumb-clear - The button to clear individual filters.\n * @part show-more - The button to display all breadcrumbs.\n * @part show-less - The button to display less breadcrumbs.\n * @part label - The \"Filters\" label.\n * @part clear - The button to clear all filters.\n */\n@Component({\n  tag: 'atomic-breadbox',\n  styleUrl: 'atomic-breadbox.pcss',\n  shadow: true,\n})\nexport class AtomicBreadbox implements InitializableComponent {\n  @InitializeBindings() public bindings!: Bindings;\n  private breadcrumbManager!: BreadcrumbManager;\n  private resizeObserver?: ResizeObserver;\n  private showMore!: HTMLButtonElement;\n  private showLess!: HTMLButtonElement;\n  private lastRemovedBreadcrumbIndex = 0;\n  private numberOfBreadcrumbs = 0;\n  private numberOfCollapsedBreadcrumbs = 0;\n  private firstExpandedBreadcrumbIndex?: number;\n  facetManager!: FacetManager;\n\n  @Element() private host!: HTMLElement;\n\n  @BindStateToController('breadcrumbManager')\n  @State()\n  private breadcrumbManagerState!: BreadcrumbManagerState;\n  @BindStateToController('facetManager')\n  @State()\n  public facetManagerState!: FacetManagerState;\n  @State() public error!: Error;\n  @State() private isCollapsed = true;\n\n  private breadcrumbRemovedFocus?: FocusTargetController;\n\n  private breadcrumbShowMoreFocus?: FocusTargetController;\n\n  private breadcrumbShowLessFocus?: FocusTargetController;\n\n  /**\n   * This prop allows you to control the display depth\n   * of the path by specifying the number of parent or ancestor\n   * breadcrumbs links relative to the currently selected value.\n   *\n   * If the path size is equal to or less than the pathLimit, all values in\n   * the path will be displayed without truncation.\n   *\n   * If the path size exceeds the pathLimit, it will truncate the path by\n   * replacing the middle values with ellipses ('...').\n   *\n   * Minimum: `1`\n   * @defaultValue `3`\n   */\n  @Prop() public pathLimit = 3;\n\n  public initialize() {\n    this.validateProps();\n    this.breadcrumbManager = buildBreadcrumbManager(this.bindings.engine);\n    this.facetManager = buildFacetManager(this.bindings.engine);\n\n    if (window.ResizeObserver) {\n      this.resizeObserver = new ResizeObserver(() => this.adaptBreadcrumbs());\n      this.resizeObserver.observe(this.host.parentElement!);\n    }\n  }\n\n  private validateProps() {\n    new Schema({\n      pathLimit: new NumberValue({\n        default: 3,\n        min: 1,\n        required: false,\n      }),\n    }).validate({\n      pathLimit: this.pathLimit,\n    });\n  }\n\n  public disconnectedCallback() {\n    this.resizeObserver?.disconnect();\n  }\n\n  private get focusTargets() {\n    if (!this.breadcrumbRemovedFocus) {\n      this.breadcrumbRemovedFocus = new FocusTargetController(this);\n    }\n    if (!this.breadcrumbShowLessFocus) {\n      this.breadcrumbShowLessFocus = new FocusTargetController(this);\n    }\n    if (!this.breadcrumbShowMoreFocus) {\n      this.breadcrumbShowMoreFocus = new FocusTargetController(this);\n    }\n    return {\n      breadcrumbRemovedFocus: this.breadcrumbRemovedFocus,\n      breadcrumbShowLessFocus: this.breadcrumbShowLessFocus,\n      breadcrumbShowMoreFocus: this.breadcrumbShowMoreFocus,\n    };\n  }\n\n  private get breadcrumbs() {\n    return Array.from(\n      this.host.shadowRoot!.querySelectorAll('li.breadcrumb')\n    ) as HTMLElement[];\n  }\n\n  private hide(element: HTMLElement) {\n    element.style.display = 'none';\n  }\n\n  private show(element: HTMLElement) {\n    element.style.display = '';\n  }\n\n  private showAllBreadcrumbs() {\n    this.breadcrumbs.forEach((breadcrumb) => this.show(breadcrumb));\n  }\n\n  private hideOverflowingBreadcrumbs() {\n    let hiddenBreadcrumbs = 0;\n    for (\n      let i = this.breadcrumbs.length - 1;\n      this.isOverflowing && i >= 0;\n      i--\n    ) {\n      this.hide(this.breadcrumbs[i]);\n      hiddenBreadcrumbs++;\n    }\n    this.updateShowMoreValue(hiddenBreadcrumbs);\n  }\n\n  private updateShowLessDisplay() {\n    this.show(this.showLess);\n    if (this.showLess.offsetTop === 0) {\n      this.hide(this.showLess);\n    }\n  }\n\n  private adaptBreadcrumbs() {\n    if (!this.breadcrumbs.length) {\n      return;\n    }\n    this.showAllBreadcrumbs();\n\n    if (!this.isCollapsed) {\n      this.updateShowLessDisplay();\n      return;\n    }\n\n    this.updateShowMoreValue(this.breadcrumbs.length);\n    this.hideOverflowingBreadcrumbs();\n  }\n\n  private get isOverflowing() {\n    const listElement = this.host.shadowRoot!.querySelector('ul');\n    if (!listElement) {\n      return false;\n    }\n    return listElement.scrollWidth > listElement.clientWidth;\n  }\n\n  private updateShowMoreValue(value: number) {\n    this.numberOfCollapsedBreadcrumbs = value;\n    if (value === 0) {\n      this.hide(this.showMore);\n      return;\n    }\n\n    this.show(this.showMore);\n    this.showMore.textContent = `+ ${value.toLocaleString(\n      this.bindings.i18n.language\n    )}`;\n\n    this.showMore.setAttribute(\n      'aria-label',\n      this.bindings.i18n.t('show-n-more-filters', {\n        value,\n      })\n    );\n  }\n\n  private get facetBreadcrumbs(): BreadboxBreadcrumb[] {\n    return this.breadcrumbManagerState.facetBreadcrumbs\n      .map(({facetId, field, values}) =>\n        values.map((value) => ({value, facetId, field}))\n      )\n      .flat()\n      .filter(({facetId}) => this.bindings.store.state.facets[facetId])\n      .map(({value, facetId, field}) => ({\n        facetId,\n        label: this.bindings.store.state.facets[facetId]?.label(),\n        state: value.value.state,\n        deselect: value.deselect,\n        formattedValue: [\n          getFieldValueCaption(field, value.value.value, this.bindings.i18n),\n        ],\n      }));\n  }\n\n  private get categoryFacetBreadcrumbs(): BreadboxBreadcrumb[] {\n    return this.breadcrumbManagerState.categoryFacetBreadcrumbs.map(\n      ({facetId, field, path, deselect}) => ({\n        facetId,\n        label: this.bindings.store.state.categoryFacets[facetId].label(),\n        deselect: deselect,\n        formattedValue: path.map((pathValue) =>\n          getFieldValueCaption(field, pathValue.value, this.bindings.i18n)\n        ),\n      })\n    );\n  }\n\n  private get numericFacetBreadcrumbs(): BreadboxBreadcrumb[] {\n    return this.breadcrumbManagerState.numericFacetBreadcrumbs\n      .map(({facetId, field, values}) =>\n        values.map((value) => ({value, facetId, field}))\n      )\n      .flat()\n      .map(({value, facetId}) => ({\n        facetId,\n        label: this.bindings.store.state.numericFacets[facetId].label(),\n        state: value.value.state,\n        deselect: value.deselect,\n        formattedValue: [\n          this.bindings.store.state.numericFacets[facetId].format(value.value),\n        ],\n        content: this.bindings.store.state.numericFacets[facetId].content?.(\n          value.value\n        ),\n      }));\n  }\n\n  private get dateFacetBreadcrumbs(): BreadboxBreadcrumb[] {\n    return this.breadcrumbManagerState.dateFacetBreadcrumbs\n      .map(({facetId, field, values}) =>\n        values.map((value) => ({value, facetId, field}))\n      )\n      .flat()\n      .map(({value, facetId}) => ({\n        facetId,\n        label: this.bindings.store.state.dateFacets[facetId].label(),\n        state: value.value.state,\n        deselect: value.deselect,\n        formattedValue: [\n          this.bindings.store.state.dateFacets[facetId].format(value.value),\n        ],\n      }));\n  }\n\n  private get automaticFacetBreadcrumbs(): BreadboxBreadcrumb[] {\n    return this.breadcrumbManagerState.automaticFacetBreadcrumbs\n      .flatMap(({facetId, field, label, values}) =>\n        values.map((value) => ({value, facetId, field, label}))\n      )\n      .map(({value, facetId, field, label}) => ({\n        facetId,\n        state: value.value.state,\n        label: label ? label : field,\n        deselect: value.deselect,\n        formattedValue: [\n          getFieldValueCaption(field, value.value.value, this.bindings.i18n),\n        ],\n      }));\n  }\n\n  private get allBreadcrumbs(): BreadboxBreadcrumb[] {\n    return [\n      ...this.facetBreadcrumbs,\n      ...this.categoryFacetBreadcrumbs,\n      ...this.numericFacetBreadcrumbs,\n      ...this.dateFacetBreadcrumbs,\n      ...this.automaticFacetBreadcrumbs,\n    ];\n  }\n\n  private renderBreadcrumbs(allBreadcrumbs: BreadboxBreadcrumb[]) {\n    const sortedBreadcrumbs = allBreadcrumbs.sort((a, b) => {\n      const indexA = this.facetManagerState.facetIds.indexOf(a.facetId);\n      const indexB = this.facetManagerState.facetIds.indexOf(b.facetId);\n      return indexA - indexB;\n    });\n    this.numberOfBreadcrumbs = sortedBreadcrumbs.length;\n\n    return [\n      sortedBreadcrumbs.map((breadcrumb, index) => {\n        const isLastBreadcrumb = this.allBreadcrumbs.length === 1;\n        return (\n          <BreadcrumbButton\n            setRef={(ref) => {\n              if (this.lastRemovedBreadcrumbIndex === index) {\n                this.focusTargets.breadcrumbRemovedFocus.setTarget(ref);\n              }\n              if (this.firstExpandedBreadcrumbIndex === index) {\n                this.focusTargets.breadcrumbShowMoreFocus.setTarget(ref);\n              }\n            }}\n            pathLimit={this.pathLimit}\n            breadcrumb={breadcrumb}\n            onSelectBreadcrumb={() => {\n              if (isLastBreadcrumb) {\n                this.bindings.store.state.resultList?.focusOnFirstResultAfterNextSearch();\n              } else if (this.numberOfBreadcrumbs > 1) {\n                this.focusTargets.breadcrumbRemovedFocus.focusAfterSearch();\n              }\n\n              this.lastRemovedBreadcrumbIndex = index;\n              breadcrumb.deselect();\n            }}\n            i18n={this.bindings.i18n}\n          >\n            <BreadcrumbContent\n              pathLimit={this.pathLimit}\n              isCollapsed={this.isCollapsed}\n              i18n={this.bindings.i18n}\n              breadcrumb={breadcrumb}\n            ></BreadcrumbContent>\n          </BreadcrumbButton>\n        );\n      }),\n    ];\n  }\n\n  public render() {\n    const allBreadcrumbs = this.allBreadcrumbs;\n\n    if (!allBreadcrumbs.length) {\n      return <Hidden></Hidden>;\n    }\n\n    return (\n      <BreadcrumbContainer\n        isCollapsed={this.isCollapsed}\n        i18n={this.bindings.i18n}\n      >\n        {this.renderBreadcrumbs(allBreadcrumbs)}\n        <BreadcrumbShowMore\n          setRef={(el) => {\n            this.showMore = el;\n          }}\n          onShowMore={() => {\n            this.firstExpandedBreadcrumbIndex =\n              this.numberOfBreadcrumbs - this.numberOfCollapsedBreadcrumbs;\n            this.focusTargets.breadcrumbShowMoreFocus.focusOnNextTarget();\n            this.isCollapsed = false;\n          }}\n          isCollapsed={this.isCollapsed}\n          i18n={this.bindings.i18n}\n          numberOfCollapsedBreadcrumbs={this.numberOfCollapsedBreadcrumbs}\n        ></BreadcrumbShowMore>\n        <BreadcrumbShowLess\n          setRef={(el) => {\n            this.showLess = el;\n          }}\n          onShowLess={() => {\n            this.focusTargets.breadcrumbShowLessFocus.focusOnNextTarget();\n            this.isCollapsed = true;\n          }}\n          isCollapsed={this.isCollapsed}\n          i18n={this.bindings.i18n}\n        ></BreadcrumbShowLess>\n        <BreadcrumbClearAll\n          setRef={() => {\n            const isFocusTarget =\n              this.lastRemovedBreadcrumbIndex === this.numberOfBreadcrumbs;\n\n            isFocusTarget\n              ? this.focusTargets.breadcrumbRemovedFocus.setTarget\n              : undefined;\n          }}\n          onClick={async () => {\n            this.breadcrumbManager.deselectAll();\n            this.bindings.store.state.resultList?.focusOnFirstResultAfterNextSearch();\n          }}\n          isCollapsed={this.isCollapsed}\n          i18n={this.bindings.i18n}\n        ></BreadcrumbClearAll>\n      </BreadcrumbContainer>\n    );\n  }\n\n  public componentDidRender() {\n    this.adaptBreadcrumbs();\n  }\n}\n"],"mappings":"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"}