{"version":3,"names":["atomicProductChildrenCss","AtomicProductChildrenStyle0","AtomicProductChildren","constructor","hostRef","this","children","activeChildId","label","field","fallback","validateProps","connectedCallback","product","permanentid","_a","Schema","StringValue","validate","onSelectChild","child","selectChildProduct","emit","getImageUrl","value","ProductTemplatesHelpers","getProductProperty","filterProtocol","Array","isArray","activeChildClasses","renderChild","h","class","title","ec_name","undefined","onKeyPress","event","key","onMouseEnter","onTouchStart","src","alt","loading","renderLabel","bindings","i18n","t","render","length","trim","map","__decorate","InitializeBindings","ProductContext"],"sources":["src/components/commerce/product-template-components/atomic-product-children/atomic-product-children.pcss?tag=atomic-product-children","src/components/commerce/product-template-components/atomic-product-children/atomic-product-children.tsx"],"sourcesContent":["@import '../../../../global/global.pcss';\n","import {Schema, StringValue} from '@coveo/bueno';\nimport {\n  Product,\n  ChildProduct,\n  ProductTemplatesHelpers,\n} from '@coveo/headless/commerce';\nimport {\n  Component,\n  h,\n  Element,\n  Prop,\n  Event,\n  EventEmitter,\n  State,\n} from '@stencil/core';\nimport {\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../../utils/initialization-utils';\nimport {filterProtocol} from '../../../../utils/xss-utils';\nimport {CommerceBindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\nimport {ProductContext} from '../product-template-decorators';\n\nexport interface SelectChildProductEventArgs {\n  child: ChildProduct;\n}\n\n/**\n * @internal\n * The `atomic-product-children` component renders a section that allows the user to select a nested product (e.g., a color variant of a given product).\n *\n * This component leverages the [product grouping](https://docs.coveo.com/en/l78i2152/) feature.\n */\n@Component({\n  tag: 'atomic-product-children',\n  styleUrl: 'atomic-product-children.pcss',\n  shadow: false,\n})\nexport class AtomicProductChildren\n  implements InitializableComponent<CommerceBindings>\n{\n  @InitializeBindings() public bindings!: CommerceBindings;\n  @ProductContext() private product!: Product;\n\n  @Element() hostElement!: HTMLElement;\n\n  @State() private children: ChildProduct[] = [];\n  @State() private activeChildId: string = '';\n\n  public error!: Error;\n\n  /**\n   * The non-localized label to display for the product children section.\n   *\n   * Set this to an empty string if you do not want to render the label at all.\n   */\n  @Prop() public label: string = 'available-in';\n\n  /**\n   * The child product field to use to render product children images. Fields in the `additionalFields` property of the child products are supported.\n   *\n   * This field should be defined on each child product, and its value should be an image URL (or an array of image URLs, in which case the component will use the first one in the array).\n   */\n  @Prop({reflect: true}) field: string = 'ec_thumbnails';\n\n  /**\n   * A fallback image URL to use when the specified `field` is not defined on a given child product, or when its value is invalid.\n   */\n  @Prop({reflect: true}) fallback: string =\n    // eslint-disable-next-line @cspell/spellchecker\n    'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"50\" viewBox=\"0 0 50 50\"%3E%3Crect width=\"50\" height=\"50\" fill=\"none\" stroke=\"gray\"%3E%3C/rect%3E%3C/svg%3E';\n\n  @Event({\n    eventName: 'atomic/selectChildProduct',\n    bubbles: true,\n  })\n  public selectChildProduct!: EventEmitter<SelectChildProductEventArgs>;\n\n  constructor() {\n    this.validateProps();\n  }\n\n  public connectedCallback(): void {\n    this.activeChildId = this.product.permanentid;\n    this.children = this.product.children ?? [];\n  }\n\n  private validateProps() {\n    new Schema({\n      label: new StringValue(),\n      field: new StringValue(),\n      fallback: new StringValue(),\n    }).validate({\n      label: this.label,\n      field: this.field,\n      fallback: this.fallback,\n    });\n  }\n\n  private onSelectChild(child: ChildProduct) {\n    this.activeChildId = child.permanentid;\n    this.selectChildProduct.emit({\n      child,\n    });\n  }\n\n  private getImageUrl(child: ChildProduct) {\n    const value = ProductTemplatesHelpers.getProductProperty(child, this.field);\n\n    if (typeof value === 'string') {\n      return filterProtocol(value);\n    }\n\n    if (Array.isArray(value) && typeof value[0] === 'string') {\n      return filterProtocol(value[0]);\n    }\n\n    return filterProtocol(this.fallback);\n  }\n\n  private get activeChildClasses() {\n    return ' box-border rounded border border-primary ';\n  }\n\n  // TODO: We could leverage the totalNumberOfRelatedProducts property on the Product to show the number of available children (e.g., ...and 3 more). This would require some UX design however.\n  private renderChild(child: ChildProduct) {\n    return (\n      <button\n        class={`product-child${child.permanentid === this.activeChildId ? this.activeChildClasses : ' '}`}\n        title={child.ec_name || undefined}\n        onKeyPress={(event) =>\n          event.key === 'Enter' && this.onSelectChild(child)\n        }\n        onMouseEnter={() => this.onSelectChild(child)}\n        onTouchStart={() => this.onSelectChild(child)}\n      >\n        <img\n          class=\"aspect-square p-1\"\n          src={this.getImageUrl(child)}\n          alt={child.ec_name || undefined}\n          loading=\"lazy\"\n        />\n      </button>\n    );\n  }\n\n  private renderLabel() {\n    return (\n      <div class=\"my-2 font-semibold text-neutral-dark\">\n        <atomic-commerce-text\n          value={this.bindings.i18n.t(this.label)}\n        ></atomic-commerce-text>\n      </div>\n    );\n  }\n\n  public render() {\n    if (this.children.length === 0) {\n      return null;\n    }\n\n    return (\n      <div>\n        {this.label.trim() !== '' && this.renderLabel()}\n        <div>{this.children.map((child) => this.renderChild(child))}</div>\n      </div>\n    );\n  }\n}\n"],"mappings":"+UAAA,MAAMA,EAA2B,wguCACjC,MAAAC,EAAeD,E,iXCqCFE,EAAqB,MAwChC,WAAAC,CAAAC,G,wEAhCiBC,KAAAC,SAA2B,GAC3BD,KAAAE,cAAwB,GAS1BF,KAAAG,MAAgB,eAORH,KAAAI,MAAgB,gBAKhBJ,KAAAK,SAErB,6L,cAxB0C,G,mBACH,G,WASV,e,WAOQ,gB,cAOrC,6LASAL,KAAKM,e,CAGA,iBAAAC,G,MACLP,KAAKE,cAAgBF,KAAKQ,QAAQC,YAClCT,KAAKC,UAAWS,EAAAV,KAAKQ,QAAQP,YAAQ,MAAAS,SAAA,EAAAA,EAAI,E,CAGnC,aAAAJ,GACN,IAAIK,EAAO,CACTR,MAAO,IAAIS,EACXR,MAAO,IAAIQ,EACXP,SAAU,IAAIO,IACbC,SAAS,CACVV,MAAOH,KAAKG,MACZC,MAAOJ,KAAKI,MACZC,SAAUL,KAAKK,U,CAIX,aAAAS,CAAcC,GACpBf,KAAKE,cAAgBa,EAAMN,YAC3BT,KAAKgB,mBAAmBC,KAAK,CAC3BF,S,CAII,WAAAG,CAAYH,GAClB,MAAMI,EAAQC,EAAwBC,mBAAmBN,EAAOf,KAAKI,OAErE,UAAWe,IAAU,SAAU,CAC7B,OAAOG,EAAeH,E,CAGxB,GAAII,MAAMC,QAAQL,WAAiBA,EAAM,KAAO,SAAU,CACxD,OAAOG,EAAeH,EAAM,G,CAG9B,OAAOG,EAAetB,KAAKK,S,CAG7B,sBAAYoB,GACV,MAAO,4C,CAID,WAAAC,CAAYX,GAClB,OACEY,EAAA,UACEC,MAAO,gBAAgBb,EAAMN,cAAgBT,KAAKE,cAAgBF,KAAKyB,mBAAqB,MAC5FI,MAAOd,EAAMe,SAAWC,UACxBC,WAAaC,GACXA,EAAMC,MAAQ,SAAWlC,KAAKc,cAAcC,GAE9CoB,aAAc,IAAMnC,KAAKc,cAAcC,GACvCqB,aAAc,IAAMpC,KAAKc,cAAcC,IAEvCY,EAAA,OACEC,MAAM,oBACNS,IAAKrC,KAAKkB,YAAYH,GACtBuB,IAAKvB,EAAMe,SAAWC,UACtBQ,QAAQ,S,CAMR,WAAAC,GACN,OACEb,EAAA,OAAKC,MAAM,wCACTD,EAAA,wBACER,MAAOnB,KAAKyC,SAASC,KAAKC,EAAE3C,KAAKG,S,CAMlC,MAAAyC,GACL,GAAI5C,KAAKC,SAAS4C,SAAW,EAAG,CAC9B,OAAO,I,CAGT,OACElB,EAAA,WACG3B,KAAKG,MAAM2C,SAAW,IAAM9C,KAAKwC,cAClCb,EAAA,WAAM3B,KAAKC,SAAS8C,KAAKhC,GAAUf,KAAK0B,YAAYX,M,oCA3H7BiC,EAAA,CAA5BC,K,+BACyBD,EAAA,CAAzBE,K"}