import{r as t,h as e,g as s}from"./p-00525453.js";import{N as i}from"./p-0e432c2f.js";import{e as r}from"./p-8f5830b4.js";import{g as o,a as n,I as h}from"./p-0e55feeb.js";import{d as c}from"./p-242e20e9.js";import{P as a}from"./p-16dc63e7.js";import"./p-b0ede3ce.js";import"./p-1580513b.js";import"./p-effc0f7e.js";import"./p-e9c4f463.js";import"./p-a2fc549d.js";const u=class{constructor(e){t(this,e);this.products=[];this.display="list";this.templateHasError=false;this.density="normal";this.imageSize="icon";this.error=undefined;this.templateHasError=false;this.density="normal";this.imageSize="icon";this.ariaLabelGenerator=undefined}async setRenderFunction(t){this.itemRenderingFunction=t}componentWillLoad(){try{c((t=>{this.bindings=t;return this.initialize()}),this.host)}catch(t){this.error=t}}getLink(t){var e;const s=t.tagName==="ATOMIC-PRODUCT"?t:t===null||t===void 0?void 0:t.querySelector("atomic-product");return((e=s===null||s===void 0?void 0:s.shadowRoot)===null||e===void 0?void 0:e.querySelector("atomic-product-link a"))||null}handleLinkClick(t,e){const s=e=>t.setAttribute("target",e);const i=t.getAttribute("target");e&&s("_blank");t.click();e&&s(i||"");return true}renderItems(){if(!this.bindings.suggestedQuery()||this.bindings.store.isMobile()){return[]}const t=this.instantProducts.state.products.length?this.instantProducts.state.products:this.products;const s=t.map((t=>{var s;const i=this.instantProducts.interactiveProduct({options:{product:t}});const n=o(this.bindings.i18n,((s=this.ariaLabelGenerator)===null||s===void 0?void 0:s.call(this,this.bindings,t))||t.ec_name,t.permanentid);return{...n,content:e("atomic-product",{key:`instant-product-${r(t.permanentid)}`,part:"outline",product:t,interactiveProduct:i,display:this.display,density:this.density,imageSize:this.imageSize,content:this.itemTemplateProvider.getTemplateContent(t),stopPropagation:false,renderingFunction:this.itemRenderingFunction}),onSelect:t=>{const e=this.getLink(t.target);if(!e){return}this.handleLinkClick(e,t.ctrlKey||t.metaKey)}}}));if(s.length){const t=n(this.bindings.i18n);s.push({...t,content:e(h,{i18n:this.bindings.i18n}),onSelect:()=>{this.bindings.clearSuggestions();this.bindings.searchBoxController.updateText(this.instantProducts.state.query);this.bindings.searchBoxController.submit()}})}return s}initialize(){this.instantProducts=i(this.bindings.engine,{options:{}});this.bindings.store.onChange("activeProductChild",(()=>{if(this.bindings.store.state.activeProductChild){this.instantProducts.promoteChildToParent(this.bindings.store.state.activeProductChild)}}));this.itemTemplateProvider=new a({includeDefaultTemplate:true,templateElements:Array.from(this.host.querySelectorAll("atomic-product-template")),getResultTemplateRegistered:()=>true,setResultTemplateRegistered:()=>{},getTemplateHasError:()=>this.templateHasError,setTemplateHasError:t=>{this.templateHasError=t}});return{position:Array.from(this.host.parentNode.children).indexOf(this.host),panel:"right",onSuggestedQueryChange:t=>{this.instantProducts.updateQuery(t);return this.onSuggestedQueryChange()},renderItems:()=>this.renderItems()}}onSuggestedQueryChange(){if(!this.bindings.getSuggestionElements().length&&!this.bindings.searchBoxController.state.value){console.warn("There doesn't seem to be any query suggestions configured. Make sure to include either an atomic-commerce-search-box-query-suggestions or atomic-commerce-search-box-recent-queries in your search box in order to see some instant products.")}return new Promise((t=>{const e=this.instantProducts.subscribe((()=>{const s=this.instantProducts.state;if(!s.isLoading){if(s.products.length){this.products=s.products}e();t()}}))}))}render(){if(this.error){return e("atomic-component-error",{key:"b5268b22ad6f9e78fdfdbab932ce542a7c785e22",element:this.host,error:this.error})}}get host(){return s(this)}};export{u as atomic_commerce_search_box_instant_products};
//# sourceMappingURL=p-e6b4483b.entry.js.map