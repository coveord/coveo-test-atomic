{"version":3,"names":["atomicCommerceFacetNumberInputCss","AtomicCommerceFacetNumberInputStyle0","FacetNumberInput","connectedCallback","this","start","_a","range","end","_b","apply","startRef","validity","valid","endRef","applyInput","emit","facet","setRanges","endInclusive","state","absoluteMinimum","field","isPriceField","includes","Number","MIN_SAFE_INTEGER","minimumInputValue","isUndefined","maximumInputValue","MAX_SAFE_INTEGER","render","facetId","label","bindings","i18n","t","minText","maxText","minAria","maxAria","applyAria","inputClasses","labelClasses","step","h","key","class","part","onSubmit","e","preventDefault","htmlFor","id","type","ref","required","min","max","value","onInput","target","valueAsNumber","Button","style","ariaLabel","text","FacetDateInput","rangeGetter","parseDate","toDate","undefined","rangeRequest","buildDateRange","setHours","rangeSetter","formattedDateValue","date","format","startLabel","endLabel","startAria","endAria","placeholder","pattern"],"sources":["src/components/commerce/facets/facet-number-input/atomic-commerce-facet-number-input.pcss?tag=atomic-commerce-facet-number-input","src/components/commerce/facets/facet-number-input/atomic-commerce-facet-number-input.tsx","src/components/common/facets/facet-date-input/facet-date-input.tsx"],"sourcesContent":["[part='input-form'] {\n  display: grid;\n  grid-template-areas:\n    'label-start label-end .'\n    'input-start input-end apply-button';\n  grid-template-columns: 1fr 1fr auto;\n}\n\n[part='label-start'] {\n  grid-area: label-start;\n}\n[part='label-end'] {\n  grid-area: label-end;\n}\n[part='input-start'] {\n  grid-area: input-start;\n}\n[part='input-end'] {\n  grid-area: input-end;\n}\n\n[part='input-apply-button'] {\n  grid-area: apply-button;\n}\n","import {isUndefined} from '@coveo/bueno';\nimport {NumericFacet} from '@coveo/headless/commerce';\nimport {Component, h, Prop, Event, EventEmitter, State} from '@stencil/core';\nimport {Button} from '../../../common/button';\nimport {CommerceBindings as Bindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\n\nexport type Range = {start: number; end: number};\n\n/**\n * Internal component made to be integrated in a NumericFacet.\n * @internal\n */\n@Component({\n  tag: 'atomic-commerce-facet-number-input',\n  styleUrl: 'atomic-commerce-facet-number-input.pcss',\n  shadow: false,\n})\nexport class FacetNumberInput {\n  private startRef!: HTMLInputElement;\n  private endRef!: HTMLInputElement;\n\n  @State() private start?: number;\n  @State() private end?: number;\n\n  @Prop() public bindings!: Bindings;\n  @Prop() public label!: string;\n  @Prop() public range?: Range;\n  @Prop() public facet!: NumericFacet;\n\n  @Event({\n    eventName: 'atomic/numberInputApply',\n  })\n  private applyInput!: EventEmitter;\n\n  public connectedCallback() {\n    this.start = this.range?.start;\n    this.end = this.range?.end;\n  }\n\n  private apply() {\n    if (!this.startRef.validity.valid || !this.endRef.validity.valid) {\n      return;\n    }\n\n    this.applyInput.emit({\n      start: this.start,\n      end: this.end,\n    });\n    this.facet.setRanges([\n      {\n        start: this.start!,\n        end: this.end!,\n        endInclusive: true,\n        state: 'selected',\n      },\n    ]);\n  }\n\n  private get absoluteMinimum(): number {\n    const {field} = this.facet.state;\n    const isPriceField = ['ec_price', 'ec_promo_price'].includes(field);\n    return isPriceField ? 0 : Number.MIN_SAFE_INTEGER;\n  }\n\n  private get minimumInputValue(): number {\n    return isUndefined(this.start) ? this.absoluteMinimum : this.start;\n  }\n\n  private get maximumInputValue() {\n    return isUndefined(this.end) ? Number.MAX_SAFE_INTEGER : this.end;\n  }\n\n  render() {\n    const {facetId} = this.facet.state;\n    const label = this.bindings.i18n.t(this.label);\n    const minText = this.bindings.i18n.t('min');\n    const maxText = this.bindings.i18n.t('max');\n    const minAria = this.bindings.i18n.t('number-input-minimum', {label});\n    const maxAria = this.bindings.i18n.t('number-input-maximum', {label});\n    const apply = this.bindings.i18n.t('apply');\n    const applyAria = this.bindings.i18n.t('number-input-apply', {label});\n\n    const inputClasses =\n      'p-2.5 input-primary placeholder-neutral-dark min-w-0 mr-1';\n    const labelClasses = 'text-neutral-dark text-sm';\n    const step = 'any';\n\n    return (\n      <form\n        class=\"mt-4 px-2 gap-y-0.5\"\n        part=\"input-form\"\n        onSubmit={(e) => {\n          e.preventDefault();\n          this.apply();\n          return false;\n        }}\n      >\n        <label\n          part=\"label-start\"\n          class={labelClasses}\n          htmlFor={`${facetId}_start`}\n        >\n          {minText}\n        </label>\n        <input\n          part=\"input-start\"\n          id={`${facetId}_start`}\n          type=\"number\"\n          step={step}\n          ref={(ref) => (this.startRef = ref!)}\n          class={inputClasses}\n          aria-label={minAria}\n          required\n          min={this.absoluteMinimum}\n          max={this.maximumInputValue}\n          value={this.range?.start}\n          onInput={(e) =>\n            (this.start = (e.target as HTMLInputElement).valueAsNumber)\n          }\n        />\n        <label part=\"label-end\" class={labelClasses} htmlFor={`${facetId}_end`}>\n          {maxText}\n        </label>\n        <input\n          part=\"input-end\"\n          id={`${facetId}_end`}\n          type=\"number\"\n          step={step}\n          ref={(ref) => (this.endRef = ref!)}\n          class={inputClasses}\n          aria-label={maxAria}\n          required\n          min={this.minimumInputValue}\n          max={Number.MAX_SAFE_INTEGER}\n          value={this.range?.end}\n          onInput={(e) =>\n            (this.end = (e.target as HTMLInputElement).valueAsNumber)\n          }\n        />\n        <Button\n          style=\"outline-primary\"\n          type=\"submit\"\n          part=\"input-apply-button\"\n          class=\"p-2.5 flex-none truncate\"\n          ariaLabel={applyAria}\n          text={apply}\n        ></Button>\n      </form>\n    );\n  }\n}\n","import {\n  buildDateRange,\n  DateFilterRange,\n  DateRangeRequest,\n} from '@coveo/headless';\nimport {Component, h, State, Prop, Event, EventEmitter} from '@stencil/core';\nimport {AnyBindings} from '../../../../components';\nimport {parseDate} from '../../../../utils/date-utils';\nimport {Button} from '../../../common/button';\n\n/**\n * Internal component made to be integrated in a TimeframeFacet.\n * @internal\n */\n@Component({\n  tag: 'atomic-facet-date-input',\n  shadow: false,\n})\nexport class FacetDateInput {\n  @State() private start?: Date;\n  @State() private end?: Date;\n  private startRef!: HTMLInputElement;\n  private endRef!: HTMLInputElement;\n\n  @Prop() public bindings!: AnyBindings;\n  @Prop() public rangeGetter!: () => DateFilterRange | undefined;\n  @Prop() public rangeSetter!: (range: DateRangeRequest) => void;\n  @Prop() public facetId!: string;\n  @Prop() public label!: string;\n  @Prop() public min?: string;\n  @Prop() public max?: string;\n\n  @Event({\n    eventName: 'atomic/dateInputApply',\n  })\n  private applyInput!: EventEmitter;\n\n  public connectedCallback() {\n    const range = this.rangeGetter();\n    this.start = range ? parseDate(range.start).toDate() : undefined;\n    this.end = range ? parseDate(range.end).toDate() : undefined;\n  }\n\n  private apply() {\n    if (!this.startRef.validity.valid || !this.endRef.validity.valid) {\n      return;\n    }\n\n    this.applyInput.emit({\n      start: this.start,\n      end: this.end,\n    });\n\n    const rangeRequest = buildDateRange({\n      start: this.start!,\n      end: this.end!.setHours(23, 59, 59, 999),\n    });\n\n    this.rangeSetter(rangeRequest);\n  }\n\n  private formattedDateValue(date?: string | Date) {\n    if (!date) {\n      return '';\n    }\n    return parseDate(date).format('YYYY-MM-DD');\n  }\n\n  render() {\n    const label = this.bindings.i18n.t(this.label);\n    const startLabel = this.bindings.i18n.t('start');\n    const endLabel = this.bindings.i18n.t('end');\n    const startAria = this.bindings.i18n.t('date-input-start', {label});\n    const endAria = this.bindings.i18n.t('date-input-end', {label});\n    const apply = this.bindings.i18n.t('apply');\n    const applyAria = this.bindings.i18n.t('date-input-apply', {label});\n\n    const inputClasses = 'input-primary p-2.5';\n    const labelClasses = 'text-neutral-dark self-center';\n\n    const placeholder = 'yyyy-mm-dd';\n    // Fallback for Safari < 14.1, date with format yyyy-mm-dd over 1400 (API limit)\n    const pattern =\n      '^(1[4-9]\\\\d{2}|2\\\\d{3})-(0[1-9]|1[0-2])-(0[1-9]|[12]\\\\d|3[01])$';\n\n    const range = this.rangeGetter();\n\n    return (\n      <form\n        class=\"grid gap-2 grid-cols-min-1fr mt-4 px-2\"\n        onSubmit={(e) => {\n          e.preventDefault();\n          this.apply();\n          return false;\n        }}\n      >\n        <label\n          part=\"input-label\"\n          class={labelClasses}\n          htmlFor={`${this.facetId}_start`}\n        >\n          {startLabel}:\n        </label>\n        <input\n          id={`${this.facetId}_start`}\n          part=\"input-start\"\n          type=\"date\"\n          ref={(ref) => (this.startRef = ref!)}\n          class={inputClasses}\n          aria-label={startAria}\n          placeholder={placeholder}\n          pattern={pattern}\n          required\n          // API/Index minimum supported date\n          min={this.min || this.formattedDateValue('1401-01-01')}\n          max={this.end ? this.formattedDateValue(this.end) : this.max}\n          value={this.formattedDateValue(range?.start)}\n          onInput={(e) =>\n            (this.start = parseDate(\n              (e.target as HTMLInputElement).value\n            ).toDate())\n          }\n        />\n        <label\n          part=\"input-label\"\n          class={labelClasses}\n          htmlFor={`${this.facetId}_end`}\n        >\n          {endLabel}:\n        </label>\n        <input\n          id={`${this.facetId}_end`}\n          part=\"input-end\"\n          type=\"date\"\n          ref={(ref) => (this.endRef = ref!)}\n          class={inputClasses}\n          aria-label={endAria}\n          placeholder={placeholder}\n          pattern={pattern}\n          required\n          min={this.min || this.formattedDateValue(this.start)}\n          max={this.max}\n          value={this.formattedDateValue(range?.end)}\n          onInput={(e) =>\n            (this.end = parseDate(\n              (e.target as HTMLInputElement).value\n            ).toDate())\n          }\n        />\n        <Button\n          style=\"outline-primary\"\n          type=\"submit\"\n          part=\"input-apply-button\"\n          class=\"p-2.5 col-span-2 truncate\"\n          ariaLabel={applyAria}\n          text={apply}\n        ></Button>\n      </form>\n    );\n  }\n}\n"],"mappings":"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"}