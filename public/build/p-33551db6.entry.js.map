{"version":3,"names":["createAtomicCommerceRecommendationStore","commonStore","createAtomicCommonStore","loadingFlags","facets","numericFacets","dateFacets","categoryFacets","facetElements","iconAssetsPath","mobileBreakpoint","DEFAULT_MOBILE_BREAKPOINT","fieldsToInclude","currentQuickviewPosition","activeProductChild","undefined","isMobile","window","matchMedia","makeDesktopQuery","state","matches","atomicCommerceRecommendationInterfaceCss","AtomicCommerceRecommendationInterfaceStyle0","AtomicCommerceRecommendationInterface","constructor","hostRef","this","store","i18n","i18next","createInstance","scrollContainer","languageAssetsPath","analytics","commonInterfaceHelper","CommonAtomicInterfaceHelper","connectedCallback","i18nClone","cloneInstance","addResourceBundle","lng","ns","resources","deep","overwrite","componentWillLoad","CspNonce","setNonce","initAriaLive","toggleAnalytics","onAnalyticsChange","updateLanguage","engineIsCreated","engine","language","contextController","setLanguage","onLanguageChange","updateIconAssetsPath","set","handleInitialization","event","onComponentInitializing","scrollToTop","scrollContainerElement","document","querySelector","bindings","logger","warn","scrollIntoView","behavior","initializeWithEngine","internalInitialization","getOrganizationEndpoints","organizationId","env","getOrganizationEndpointsHeadless","interfaceElement","host","createStyleElement","styleTag","createElement","setAttribute","createScriptElement","initContext","buildContext","initLanguage","Array","from","children","some","element","tagName","prepend","initEngine","onInitialization","render","h","key"],"sources":["src/components/commerce/atomic-commerce-recommendation-interface/store.ts","src/components/commerce/atomic-commerce-recommendation-interface/atomic-commerce-recommendation-interface.pcss?tag=atomic-commerce-recommendation-interface&encapsulation=shadow","src/components/commerce/atomic-commerce-recommendation-interface/atomic-commerce-recommendation-interface.tsx"],"sourcesContent":["import {ChildProduct} from '@coveo/headless/commerce';\nimport {DEFAULT_MOBILE_BREAKPOINT} from '../../../utils/replace-breakpoint';\nimport {\n  AtomicCommonStore,\n  AtomicCommonStoreData,\n  createAtomicCommonStore,\n} from '../../common/interface/store';\nimport {makeDesktopQuery} from '../atomic-commerce-layout/commerce-layout';\n\nexport interface AtomicStoreData extends AtomicCommonStoreData {\n  mobileBreakpoint: string;\n  currentQuickviewPosition: number;\n  activeProductChild: ChildProduct | undefined;\n}\n\nexport interface AtomicCommerceRecommendationStore\n  extends AtomicCommonStore<AtomicStoreData> {\n  isMobile(): boolean;\n}\n\nexport function createAtomicCommerceRecommendationStore(): AtomicCommerceRecommendationStore {\n  const commonStore = createAtomicCommonStore<AtomicStoreData>({\n    loadingFlags: [],\n    facets: {},\n    numericFacets: {},\n    dateFacets: {},\n    categoryFacets: {},\n    facetElements: [],\n    iconAssetsPath: '',\n    mobileBreakpoint: DEFAULT_MOBILE_BREAKPOINT,\n    fieldsToInclude: [],\n    currentQuickviewPosition: -1,\n    activeProductChild: undefined,\n  });\n\n  return {\n    ...commonStore,\n\n    isMobile() {\n      return !window.matchMedia(\n        makeDesktopQuery(commonStore.state.mobileBreakpoint)\n      ).matches;\n    },\n  };\n}\n","@import '../../../global/global.pcss';\n\n:host {\n  height: inherit;\n  width: inherit;\n  & > slot {\n    height: inherit;\n  }\n}\n","import {\n  PlatformEnvironment,\n  getOrganizationEndpoints as getOrganizationEndpointsHeadless,\n  CommerceEngine,\n  CommerceEngineConfiguration,\n  Context,\n  buildContext,\n} from '@coveo/headless/commerce';\nimport {\n  Component,\n  Prop,\n  h,\n  Listen,\n  Method,\n  Watch,\n  Element,\n  State,\n  setNonce,\n} from '@stencil/core';\nimport i18next, {i18n} from 'i18next';\nimport {InitializeEvent} from '../../../utils/initialization-utils';\nimport {CommonBindings, NonceBindings} from '../../common/interface/bindings';\nimport {\n  BaseAtomicInterface,\n  CommonAtomicInterfaceHelper,\n} from '../../common/interface/interface-common';\nimport {\n  AtomicCommerceRecommendationStore,\n  createAtomicCommerceRecommendationStore,\n} from './store';\n\nexport type CommerceInitializationOptions = CommerceEngineConfiguration;\nexport type CommerceBindings = CommonBindings<\n  CommerceEngine,\n  AtomicCommerceRecommendationStore,\n  HTMLAtomicCommerceInterfaceElement\n> &\n  NonceBindings;\n\n/**\n * @internal\n * The `atomic-commerce-recommendation-interface` component is meant to be used as the parent of one or more `atomic-commerce-recommendation-list` components. It handles the headless search engine and localization configurations.\n */\n@Component({\n  tag: 'atomic-commerce-recommendation-interface',\n  styleUrl: 'atomic-commerce-recommendation-interface.pcss',\n  shadow: true,\n  assetsDirs: ['lang'],\n})\nexport class AtomicCommerceRecommendationInterface\n  implements BaseAtomicInterface<CommerceEngine>\n{\n  private store = createAtomicCommerceRecommendationStore();\n  private commonInterfaceHelper: CommonAtomicInterfaceHelper<CommerceEngine>;\n\n  @Element() public host!: HTMLAtomicCommerceInterfaceElement;\n\n  @State() public error?: Error;\n\n  /**\n   * The commerce interface i18next instance.\n   */\n  @Prop() public i18n: i18n = i18next.createInstance();\n\n  /**\n   * The commerce interface headless engine.\n   */\n  @Prop({mutable: true}) public engine!: CommerceEngine;\n\n  /**\n   * The CSS selector for the container the interface will scroll back to.\n   */\n  @Prop({reflect: true}) public scrollContainer =\n    'atomic-commerce-recommendation-interface';\n\n  /**\n   * The language assets path. By default, this will be a relative URL pointing to `./lang`.\n   *\n   * Example: \"/mypublicpath/languages\"\n   *\n   */\n  @Prop({reflect: true}) public languageAssetsPath = './lang';\n\n  /**\n   * The icon assets path. By default, this will be a relative URL pointing to `./assets`.\n   *\n   * Example: \"/mypublicpath/icons\"\n   *\n   */\n  @Prop({reflect: true}) public iconAssetsPath = './assets';\n\n  /**\n   * The value to set the [nonce](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/nonce) attribute to on inline script and style elements generated by this interface and its child components.\n   * If your application is served with a Content Security Policy (CSP) that doesn't include the `script-src: 'unsafe-inline'` or `style-src: 'unsafe-inline'` directives,\n   * you should ensure that your application server generates a new nonce on every page load and uses the generated value to set this prop and serve the corresponding CSP response headers\n   * (i.e., script-src 'nonce-<YOUR_GENERATED_NONCE>' and style-src 'nonce-<YOUR_GENERATED_NONCE>').\n   * Otherwise you may see console errors such as\n   *  - Refused to execute inline script because it violates the following Content Security Policy directive: [...]\n   *  - Refused to apply inline style because it violates the following Content Security Policy directive: [...].\n   * @example:\n   * ```html\n   * <script nonce=\"<YOUR_GENERATED_NONCE>\">\n   *  import {setNonce} from '@coveo/atomic';\n   *  setNonce('<YOUR_GENERATED_NONCE>');\n   * </script>\n   * ```\n   */\n  @Prop({reflect: true}) public CspNonce?: string;\n\n  /**\n   * The commerce interface language.\n   *\n   * Will default to the value set in the Headless engine context if not provided.\n   */\n  @Prop({reflect: true, mutable: true}) public language?: string;\n\n  /**\n   * Whether to enable analytics.\n   */\n  @Prop({reflect: true}) public analytics = true;\n\n  private i18nClone!: i18n;\n\n  private contextController!: Context;\n\n  public constructor() {\n    this.commonInterfaceHelper = new CommonAtomicInterfaceHelper(\n      this,\n      'CoveoAtomic'\n    );\n  }\n\n  public connectedCallback() {\n    this.i18nClone = this.i18n.cloneInstance();\n    this.i18n.addResourceBundle = (\n      lng: string,\n      ns: string,\n      resources: object,\n      deep?: boolean,\n      overwrite?: boolean\n    ) => this.addResourceBundle(lng, ns, resources, deep, overwrite);\n  }\n\n  componentWillLoad() {\n    if (this.CspNonce) {\n      setNonce(this.CspNonce);\n    }\n    this.initAriaLive();\n  }\n\n  @Watch('analytics')\n  public toggleAnalytics() {\n    this.commonInterfaceHelper.onAnalyticsChange();\n  }\n\n  @Watch('language')\n  public updateLanguage() {\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\n      return;\n    }\n\n    if (!this.language) {\n      return;\n    }\n\n    this.contextController.setLanguage(this.language);\n\n    this.commonInterfaceHelper.onLanguageChange();\n  }\n\n  @Watch('iconAssetsPath')\n  public updateIconAssetsPath() {\n    this.store.set('iconAssetsPath', this.iconAssetsPath);\n  }\n\n  @Listen('atomic/initializeComponent')\n  public handleInitialization(event: InitializeEvent) {\n    this.commonInterfaceHelper.onComponentInitializing(event);\n  }\n\n  @Listen('atomic/scrollToTop')\n  public scrollToTop() {\n    const scrollContainerElement = document.querySelector(this.scrollContainer);\n    if (!scrollContainerElement) {\n      this.bindings.engine.logger.warn(\n        `Could not find the scroll container with the selector \"${this.scrollContainer}\". This will prevent UX interactions that require a scroll from working correctly. Please check the CSS selector in the scrollContainer option`\n      );\n      return;\n    }\n\n    scrollContainerElement.scrollIntoView({behavior: 'smooth'});\n  }\n\n  /**\n   * Initializes the connection with an already preconfigured [headless commerce engine](https://docs.coveo.com/en/headless/latest/reference/commerce/).\n   */\n  @Method() public initializeWithEngine(engine: CommerceEngine) {\n    return this.internalInitialization(() => (this.engine = engine));\n  }\n\n  /**\n   * Returns the unique, organization-specific endpoint(s).\n   * @param {string} organizationId\n   * @param {'prod'|'hipaa'|'staging'|'dev'} [env=Prod]\n   */\n  @Method() public async getOrganizationEndpoints(\n    organizationId: string,\n    env: PlatformEnvironment = 'prod'\n  ) {\n    return getOrganizationEndpointsHeadless(organizationId, env);\n  }\n\n  public get bindings(): CommerceBindings {\n    return {\n      engine: this.engine!,\n      i18n: this.i18n,\n      store: this.store,\n      interfaceElement: this.host,\n      createStyleElement: () => {\n        const styleTag = document.createElement('style');\n        if (this.CspNonce) {\n          styleTag.setAttribute('nonce', this.CspNonce);\n        }\n        return styleTag;\n      },\n      createScriptElement: () => {\n        const styleTag = document.createElement('script');\n        if (this.CspNonce) {\n          styleTag.setAttribute('nonce', this.CspNonce);\n        }\n        return styleTag;\n      },\n    };\n  }\n\n  private initContext() {\n    this.contextController = buildContext(this.bindings.engine);\n  }\n\n  private initLanguage() {\n    if (!this.language) {\n      this.language = this.contextController.state.language;\n    }\n  }\n\n  private initAriaLive() {\n    if (\n      Array.from(this.host.children).some(\n        (element) => element.tagName === 'ATOMIC-ARIA-LIVE'\n      )\n    ) {\n      return;\n    }\n    this.host.prepend(document.createElement('atomic-aria-live'));\n  }\n\n  private async internalInitialization(initEngine: () => void) {\n    await this.commonInterfaceHelper.onInitialization(initEngine);\n    this.initContext();\n    this.initLanguage();\n  }\n\n  private addResourceBundle(\n    lng: string,\n    ns: string,\n    resources: object,\n    deep?: boolean,\n    overwrite?: boolean\n  ) {\n    return this.i18nClone.addResourceBundle(\n      lng,\n      ns,\n      resources,\n      deep,\n      overwrite\n    );\n  }\n\n  public render() {\n    return [<slot></slot>];\n  }\n}\n"],"mappings":"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"}